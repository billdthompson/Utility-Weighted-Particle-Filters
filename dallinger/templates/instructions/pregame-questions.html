{% extends "layout.html" %}

{% block stylesheets %}
    <link rel=stylesheet href="/static/css/bootstrap.min.css" type="text/css">
    <link rel='stylesheet' type='text/css' href='/static/css/custom.css'/>  
{% endblock %}

{% block body %}
<font size="+1">
    <div class="main_div" id="questions-div">
        <h1>Questions</h1>
        
        <div class="main_div">
            <form>
            	{% block replace_questions %}
	                {% block questions %}
	                {% endblock %}
	                <div class="row question" id='question-1'>
	                    <div class="col-md-8">
	                       On every round of the experiment, your task is to:
                      </div>
                      <br>
	                    <div class="col-md-4">
	                        <select id="q1" name="q1">
	                        </select>
	                    </div>
	                </div>
                  <br>
                  <br>
	                <div class="row question" id='question-2'>
	                    <div class="col-md-8" id = 'question-text-2'>
	                        Which color of dots give you a bonus?
                      </div>
                      <br>
	                    <div class="col-md-4">
	                        <select id="q2" name="q2">
	                        </select>
	                    </div>
                  </div>
                  <br>
                  <br>
                  <div class="row question" id='question-3'>
	                    <div class="col-md-8" id='dot-type-question'>
	                        Does the bonus for a certain color of dot pay if your decision is wrong?
                      </div>
                      <br>
                      <br>
	                    <div class="col-md-4">
	                        <select id="q3" name="q3">
                              <option value="1">Yes</option>
                              <option value="2">No</option>
                              <option value="3" SELECTED>None of these options</option>
	                        </select>
	                    </div>
                  </div>
                  <br>
                  <br>


                  <div class="row question" id='question-4'>
                  </div>

                  <div class="row question" id='question-5'>
                  </div>
                  
                  <br>
                  <hr>
	            {% endblock %}
            </form>
        </div>
        <di class="instructionsnav">
            <div class="row">
                <div class="col-xs-2">
                </div>
                <div class="col-xs-7">
                </div>
                <div class="col-xs-3">
                    <button type="button" id="submit-pregame-questions" class="btn btn-primary btn-lg continue">Submit</button>
                </div>
            </div>
      </div>

<!-- Instructions Div - pass the experiment -->
<div class="instructions" id="instructions-div-success" style="visibility:hidden">
    <p style='text-align:center;'>
    <span id="instructions-text-10"><font size="+2">Thank you!</font></span>
    <br>
    <br>
    <br>
    </p>
    <div align="center"><button type="button" class="btn btn-success btn-lg" id="instructions-next" onClick="beginExperiment()">Start experiment&raquo;</button></div>
</div>

<!-- Instructions Div -->
<div class="instructions" id="instructions-div-failure" style="visibility:hidden">
    
    <span id="instructions-text-2"><font size="+1"></font></span>
    <br>
    <hr>
    <span id="instructions-text-3"><font size="+1"></font></span>
    <br>
    <hr>
    <span id="instructions-text-4"><font size="+1"</font></span>
    <br>
    <hr>
    <span id="instructions-text-5"><font size="+1"></font></span>
    <br>
    <hr>
    <span id="instructions-text-6"><font size="+1"></font></span>
    <br>
    <hr>
    <div align="right"><button type="button" class="btn btn-primary btn-lg continue" id="instructions-next" onClick="showQuestions()"><font size="+1">Try again</font> &raquo;</button></div>

    </div>
  </font>
{% endblock %}

{% block scripts %}
  <script type="text/javascript">

  var cover_story = localStorage.getItem('cover_story')=='true';
  var generation = parseInt(localStorage.getItem('generation'));
  var payout_blue = localStorage.getItem('payout_blue')=='true';
  var condition = localStorage.getItem('condition')

  // hacky but gets the job done
  if (generation==0 || condition=='asocial'){
    condition='asocial'
  }



  if (cover_story==false){
    // without cover
    if (condition=='asocial'){
      //asocial
      if (payout_blue==true){
        // Asocial, without cover, payout blue
        $('#q1').html('<option value="1">Judge whether there are more blue dots or more yellow dots</option>'+
                              '<option value="2">Judge how many yellow dots are in the image</option>'+
                              '<option value="3">Judge how many blue dots are in the image</option>'+
	                            '<option value="4" SELECTED>None of these options</option>')
        $('#q2').html('<option value="2">Yellow</option>'+
                        '<option value="1">Blue</option>'+
                        '<option value="3" SELECTED>None of these options</option>')
        $('#question-4').css('display','none')
        $('#question-5').css('display','none')

        $('#instructions-text-2').html('1). On every round, you must judge '+
        'whether there are more blue dots or more yellow dots in the image.')
        $('#instructions-text-3').html('2). You will get a bonus for every blue dot in the image.')
        $('#instructions-text-4').html('3). You will get this bonus for blue dots regardless of whether your decision is correct.')
        $('#instructions-text-5').css('display','none')
        $('#instructions-text-6').css('display','none')

      } else{
        // Asocial, without cover, payout yellow
        $('#q1').html('<option value="1">Judge whether there are more blue dots or more yellow dots</option>'+
                              '<option value="2">Judge how many yellow dots are in the image</option>'+
                              '<option value="3">Judge how many blue dots are in the image</option>'+
	                            '<option value="4" SELECTED>None of these options</option>')
        $('#q2').html('<option value="1">Yellow</option>'+
                        '<option value="2">Blue</option>'+
                        '<option value="3" SELECTED>None of these options</option>')
        $('#question-4').css('display','none')
        $('#question-5').css('display','none')

        $('#instructions-text-2').html('1). On every round, you must judge '+
        'whether there are more blue dots or more yellow dots in the image.')
        $('#instructions-text-3').html('2). You will get a bonus for every yellow dot in the image.')
        $('#instructions-text-4').html('3). You will get this bonus for yellow dots regardless of whether your decision is correct.')
        $('#instructions-text-5').css('display','none')
        $('#instructions-text-6').css('display','none')
      }
    } else if (condition='social_with_info'){
      //social with info
      if (payout_blue==true){
        // social with info, no cover story, payout blue
        $('#q1').html('<option value="1">Judge whether there are more blue dots or more yellow dots</option>'+
                              '<option value="2">Judge how many yellow dots are in the image</option>'+
                              '<option value="3">Judge how many blue dots are in the image</option>'+
	                            '<option value="4" SELECTED>None of these options</option>')
        $('#q2').html('<option value="2">Yellow</option>'+
                        '<option value="1">Blue</option>'+
                        '<option value="3" SELECTED>None of these options</option>')
        $('#question-4').html('<div class="col-md-8" id="social-info">'+
	                        'Before viewing an image, what information will you get?'+
	                    '</div><br>'+
	                    '<div class="col-md-4">'+
	                        '<select id="q4" name="q4">'+
                              "<option value='2'>Another participant's decision in a different image</option>"+
                              '<option value="3">A previous decision you made</option>'+
                              "<option value='1'>Another participant's decision on an image with the same number of blue and yellow dots.</option>"+
                              '<option value="5" SELECTED>None of these options</option>'+
                          '</select></div>')
        $('#question-5').html('<div class="col-md-8" id="social-info">'+
                  'Was this participant also paid for blue dots?'+
              '</div><br>'+
              '<div class="col-md-4">'+
                  '<select id="q5" name="q5">'+
                      "<option value='1'>Yes</option>"+
                      '<option value="3">No</option>'+
                      "<option value='4'>Sometimes</option>"+
                      '<option value="5" SELECTED>None of these options</option>'+
                  '</select></div>')

        $('#instructions-text-2').html('1). On every round, you must judge '+
        'whether there are more blue dots or more yellow dots in the image.')
        $('#instructions-text-3').html('2). You will get a bonus for every blue dot in the image.')
        $('#instructions-text-4').html('3). You will get this bonus for blue dots regardless of whether your decision is correct.')
        $('#instructions-text-5').html('4). Before viewing an image, you will view the decision made by another participant '+
        'viewing an image with the same number of blue dots and yellow dots.')
        $('#instructions-text-6').html('5). This participant was also paid every blue dot in the image.')
      } else
      // social with info, no cover story, payout yellow
      $('#q1').html('<option value="1">Judge whether there are more blue dots or more yellow dots</option>'+
                              '<option value="2">Judge how many yellow dots are in the image</option>'+
                              '<option value="3">Judge how many blue dots are in the image</option>'+
	                            '<option value="4" SELECTED>None of these options</option>')
        $('#q2').html('<option value="1">Yellow</option>'+
                        '<option value="2">Blue</option>'+
                        '<option value="3" SELECTED>None of these options</option>')
        $('#question-4').html('<div class="col-md-8" id="social-info">'+
	                        'Before viewing an image, what information will you get?'+
	                    '</div><br>'+
	                    '<div class="col-md-4">'+
	                        '<select id="q4" name="q4">'+
                              "<option value='2'>Another participant's decision in a different image</option>"+
                              '<option value="3">A previous decision you made</option>'+
                              "<option value='1'>Another participant's decision on an image with the same number of blue and yellow dots.</option>"+
                              '<option value="5" SELECTED>None of these options</option>'+
                          '</select></div>')
        $('#question-5').html('<div class="col-md-8" id="social-info">'+
                  'Was this participant also paid for yellow dots?'+
              '</div><br>'+
              '<div class="col-md-4">'+
                  '<select id="q5" name="q5">'+
                      "<option value='1'>Yes</option>"+
                      '<option value="3">No</option>'+
                      "<option value='4'>Sometimes</option>"+
                      '<option value="5" SELECTED>None of these options</option>'+
                  '</select></div>')

        $('#instructions-text-2').html('1). On every round, you must judge '+
        'whether there are more blue dots or more yellow dots in the image.')
        $('#instructions-text-3').html('2). You will get a bonus for every yellow dot in the image.')
        $('#instructions-text-4').html('3). You will get this bonus for yellow dots regardless of whether your decision is correct.')
        $('#instructions-text-5').html('4). Before viewing an image, you will view the decision made by another participant '+
        'viewing an image with the same number of blue dots and yellow dots.')
        $('#instructions-text-6').html('5). This participant was also paid every yellow dot in the image.')
    } else{
      //social without info
      if (payout_blue==true){
        //social without info, no cover, payout blue
        $('#q1').html('<option value="1">Judge whether there are more blue dots or more yellow dots</option>'+
                              '<option value="2">Judge how many yellow dots are in the image</option>'+
                              '<option value="3">Judge how many blue dots are in the image</option>'+
	                            '<option value="4" SELECTED>None of these options</option>')
        $('#q2').html('<option value="2">Yellow</option>'+
                        '<option value="1">Blue</option>'+
                        '<option value="3" SELECTED>None of these options</option>')
        $('#question-4').html('<div class="col-md-8" id="social-info">'+
	                        'Before viewing an image, what information will you get?'+
	                    '</div><br>'+
	                    '<div class="col-md-4">'+
	                        '<select id="q4" name="q4">'+
                              "<option value='2'>Another participant's decision in a different image</option>"+
                              '<option value="3">A previous decision you made</option>'+
                              "<option value='1'>Another participant's decision on an image with the same number of blue and yellow dots.</option>"+
                              '<option value="5" SELECTED>None of these options</option>'+
                          '</select></div>')
        $('#question-5').css('display','none')

        $('#instructions-text-2').html('1). On every round, you must judge '+
        'whether there are more blue dots or more yellow dots in the image.')
        $('#instructions-text-3').html('2). You will get a bonus for every blue dot in the image.')
        $('#instructions-text-4').html('3). You will get this bonus for blue dots regardless of whether your decision is correct.')
        $('#instructions-text-5').html('4). Before viewing an image, you will view the decision made by another participant '+
        'viewing an image with the same number of blue dots and yellow dots.')
        $('#instructions-text-6').css('display','none')
      } else{
        //social without info, no cover, payout yellow
        $('#q1').html('<option value="1">Judge whether there are more blue dots or more yellow dots</option>'+
                              '<option value="2">Judge how many yellow dots are in the image</option>'+
                              '<option value="3">Judge how many blue dots are in the image</option>'+
	                            '<option value="4" SELECTED>None of these options</option>')
        $('#q2').html('<option value="1">Yellow</option>'+
                        '<option value="2">Blue</option>'+
                        '<option value="3" SELECTED>None of these options</option>')
        $('#question-4').html('<div class="col-md-8" id="social-info">'+
	                        'Before viewing an image, what information will you get?'+
	                    '</div><br>'+
	                    '<div class="col-md-4">'+
	                        '<select id="q4" name="q4">'+
                              "<option value='2'>Another participant's decision in a different image</option>"+
                              '<option value="3">A previous decision you made</option>'+
                              "<option value='1'>Another participant's decision on an image with the same number of blue and yellow dots.</option>"+
                              '<option value="5" SELECTED>None of these options</option>'+
                          '</select></div>')
        $('#question-5').css('display','none')

        $('#instructions-text-2').html('1). On every round, you must judge '+
        'whether there are more blue dots or more yellow dots in the image.')
        $('#instructions-text-3').html('2). You will get a bonus for every yellow dot in the image.')
        $('#instructions-text-4').html('3). You will get this bonus for yellow dots regardless of whether your decision is correct.')
        $('#instructions-text-5').html('4). Before viewing an image, you will view the decision made by another participant '+
        'viewing an image with the same number of blue dots and yellow dots.')
        $('#instructions-text-6').css('display','none')
      }
    }
  } else{
    // with cover story
    $('#dot-type-question').html('Does the bonus for a certain type of dot pay if your decision is wrong?')
    if (condition=='asocial'){
      //asocial
      if (payout_blue==true){
        // with cover, asocial, payout blue
        $('#q1').html('<option value="1">Judge whether there are more water dots or more sand dots</option>'+
                              '<option value="2">Judge how many sand dots are in the area</option>'+
                              '<option value="3">Judge how many water dots are in the area</option>'+
                              '<option value="4" SELECTED>None of these options</option>')
        $('#question-text-2').html('Which type of dots gives you a bonus?')
        $('#q2').html('<option value="2">Sand</option>'+
                        '<option value="1">Water</option>'+
                        '<option value="3" SELECTED>None of these options</option>')
        $('#question-4').css('display','none')
        $('#question-5').css('display','none')

        $('#instructions-text-2').html('1). On every round, you must judge '+
        'whether there are more water dots or more sand dots in the area.')
        $('#instructions-text-3').html('2). You will get a bonus for every water dot in the area.')
        $('#instructions-text-4').html('3). You will get this bonus for water dots regardless of whether your decision is correct.')
        $('#instructions-text-5').css('display','none')
        $('#instructions-text-6').css('display','none')

      } else{
        // with cover, asocial, payout yellow
        $('#q1').html('<option value="1">Judge whether there are more gold dots or more water dots</option>'+
                              '<option value="2">Judge how many gold dots are in the area</option>'+
                              '<option value="3">Judge how many water dots are in the area</option>'+
                              '<option value="4" SELECTED>None of these options</option>')
        
        $('#question-text-2').html('Which type of dots gives you a bonus?')
        $('#q2').html('<option value="1">Gold</option>'+
                        '<option value="2">Water</option>'+
                        '<option value="3" SELECTED>None of these options</option>')
        $('#question-4').css('display','none')
        $('#question-5').css('display','none')

        $('#instructions-text-2').html('1). On every round, you must judge '+
        'whether there are more gold dots or more water dots in the area.')
        $('#instructions-text-3').html('2). You will get a bonus for every gold dot in the area.')
        $('#instructions-text-4').html('3). You will get this bonus for gold dots regardless of whether your decision is correct.')
        $('#instructions-text-5').css('display','none')
        $('#instructions-text-6').css('display','none')

      }
    } else if (condition=='social_with_info'){
      // social with info
      if (payout_blue==true){
        // with cover, social with info, payout blue
        $('#q1').html('<option value="1">Judge whether there are more water dots or more sand dots</option>'+
                              '<option value="2">Judge how many sand dots are in the area</option>'+
                              '<option value="3">Judge how many water dots are in the area</option>'+
                              '<option value="4" SELECTED>None of these options</option>')
        $('#question-text-2').html('Which type of dots gives you a bonus?')
        $('#q2').html('<option value="2">Sand</option>'+
                        '<option value="1">Water</option>'+
                        '<option value="3" SELECTED>None of these options</option>')
        $('#question-4').html('<div class="col-md-8" id="social-info">'+
	                        'Before viewing an area, what information will you get?'+
	                    '</div><br>'+
	                    '<div class="col-md-4">'+
	                        '<select id="q4" name="q4">'+
                              "<option value='2'>Another participant's decision in a different area</option>"+
                              '<option value="3">A previous decision you made</option>'+
                              "<option value='1'>Another participant's decision on an area with the same number of water and sand dots.</option>"+
                              '<option value="5" SELECTED>None of these options</option>'+
                          '</select></div>')
        $('#question-5').html('<div class="col-md-8" id="social-info">'+
                  'Was this participant also paid for water dots?'+
              '</div><br>'+
              '<div class="col-md-4">'+
                  '<select id="q5" name="q5">'+
                      "<option value='1'>Yes</option>"+
                      '<option value="3">No</option>'+
                      "<option value='4'>Sometimes</option>"+
                      '<option value="5" SELECTED>None of these options</option>'+
                  '</select></div>')

        $('#instructions-text-2').html('1). On every round, you must judge '+
        'whether there are more water dots or more sand dots in the area.')
        $('#instructions-text-3').html('2). You will get a bonus for every water dot in the area.')
        $('#instructions-text-4').html('3). You will get this bonus for water dots regardless of whether your decision is correct.')
        $('#instructions-text-5').html('4). Before viewing an area, you will view the decision made by another participant '+
        'viewing an area with the same number of water dots and sand dots.')
        $('#instructions-text-6').html('5). This participant was also paid every water dot in the area.')

      } else{
        // with cover, social with info, payout yellow
        $('#q1').html('<option value="1">Judge whether there are more gold dots or more water dots</option>'+
                              '<option value="2">Judge how many gold dots are in the area</option>'+
                              '<option value="3">Judge how many water dots are in the area</option>'+
                              '<option value="4" SELECTED>None of these options</option>')
        
        $('#question-text-2').html('Which type of dots gives you a bonus?')
        $('#q2').html('<option value="1">Gold</option>'+
                        '<option value="2">Water</option>'+
                        '<option value="3" SELECTED>None of these options</option>')
        $('#question-4').html('<div class="col-md-8" id="social-info">'+
	                        'Before viewing an area, what information will you get?'+
	                    '</div><br>'+
	                    '<div class="col-md-4">'+
	                        '<select id="q4" name="q4">'+
                              "<option value='2'>Another participant's decision in a different area</option>"+
                              '<option value="3">A previous decision you made</option>'+
                              "<option value='1'>Another participant's decision on an area with the same number of gold and water dots.</option>"+
                              '<option value="5" SELECTED>None of these options</option>'+
                          '</select></div>')
        $('#question-5').html('<div class="col-md-8" id="social-info">'+
                  'Was this participant also paid for gold dots?'+
              '</div><br>'+
              '<div class="col-md-4">'+
                  '<select id="q5" name="q5">'+
                      "<option value='1'>Yes</option>"+
                      '<option value="3">No</option>'+
                      "<option value='4'>Sometimes</option>"+
                      '<option value="5" SELECTED>None of these options</option>'+
                  '</select></div>')

        $('#instructions-text-2').html('1). On every round, you must judge '+
        'whether there are more gold dots or more water dots in the area.')
        $('#instructions-text-3').html('2). You will get a bonus for every gold dot in the area.')
        $('#instructions-text-4').html('3). You will get this bonus for gold dots regardless of whether your decision is correct.')
        $('#instructions-text-5').html('4). Before viewing an area, you will view the decision made by another participant '+
        'viewing an area with the same number of gold dots and water dots.')
        $('#instructions-text-6').html('5). This participant was also paid every gold dot in the area.')
      }
    } else{
      // social without info
      if (payout_blue==true){
        // with cover, social without info, payout blue
        $('#q1').html('<option value="1">Judge whether there are more water dots or more sand dots</option>'+
                              '<option value="2">Judge how many sand dots are in the area</option>'+
                              '<option value="3">Judge how many water dots are in the area</option>'+
                              '<option value="4" SELECTED>None of these options</option>')
        
        $('#question-text-2').html('Which type of dots gives you a bonus?')
        $('#q2').html('<option value="2">Sand</option>'+
                        '<option value="1">Water</option>'+
                        '<option value="3" SELECTED>None of these options</option>')
        $('#question-4').html('<div class="col-md-8" id="social-info">'+
	                        'Before viewing an area, what information will you get?'+
	                    '</div><br>'+
	                    '<div class="col-md-4">'+
	                        '<select id="q4" name="q4">'+
                              "<option value='2'>Another participant's decision in a different area</option>"+
                              '<option value="3">A previous decision you made</option>'+
                              "<option value='1'>Another participant's decision on an area with the same number of water and sand dots.</option>"+
                              '<option value="5" SELECTED>None of these options</option>'+
                          '</select></div>')
        $('#question-5').css('display','none')

        $('#instructions-text-2').html('1). On every round, you must judge '+
        'whether there are more water dots or more sand dots in the area.')
        $('#instructions-text-3').html('2). You will get a bonus for every water dot in the area.')
        $('#instructions-text-4').html('3). You will get this bonus for water dots regardless of whether your decision is correct.')
        $('#instructions-text-5').html('4). Before viewing an area, you will view the decision made by another participant '+
        'viewing an area with the same number of water dots and sand dots.')
        $('#instructions-text-6').css('display','none')

      } else{
        // with cover, social without info, payout yellow
        $('#q1').html('<option value="1">Judge whether there are more gold dots or more water dots</option>'+
                              '<option value="2">Judge how many gold dots are in the area</option>'+
                              '<option value="3">Judge how many water dots are in the area</option>'+
                              '<option value="4" SELECTED>None of these options</option>')
        
        $('#question-text-2').html('Which type of dots gives you a bonus?')
        $('#q2').html('<option value="1">Gold</option>'+
                        '<option value="2">Water</option>'+
                        '<option value="3" SELECTED>None of these options</option>')
        $('#question-4').html('<div class="col-md-8" id="social-info">'+
	                        'Before viewing an area, what information will you get?'+
	                    '</div><br>'+
	                    '<div class="col-md-4">'+
	                        '<select id="q4" name="q4">'+
                              "<option value='2'>Another participant's decision in a different area</option>"+
                              '<option value="3">A previous decision you made</option>'+
                              "<option value='1'>Another participant's decision on an area with the same number of gold and water dots.</option>"+
                              '<option value="5" SELECTED>None of these options</option>'+
                          '</select></div>')
        $('#question-5').css('display','none')

        $('#instructions-text-2').html('1). On every round, you must judge '+
        'whether there are more gold dots or more water dots in the area.')
        $('#instructions-text-3').html('2). You will get a bonus for every gold dot in the area.')
        $('#instructions-text-4').html('3). You will get this bonus for gold dots regardless of whether your decision is correct.')
        $('#instructions-text-5').html('4). Before viewing an area, you will view the decision made by another participant '+
        'viewing an area with the same number of gold dots and water dots.')
        $('#instructions-text-6').css('display','none')

      }
    }
  }


      beginExperiment = function () {
        var yellow_left = Math.random()<=0.5;
        localStorage.setItem('yellow_left',yellow_left)
        if (yellow_left==true){
          dallinger.goToPage('stage_yellow_left')
        } else{
          dallinger.goToPage('stage_blue_left')
        }
      }

      showQuestions = function () {
        $("#questions-div").show()
        $("#instructions-div-failure").hide()
      }

      submitQuestions = function () {
        spinner = dallinger.BusyForm()
        spinner.freeze([])

        // populate dictionary of redsponses
        var formSerialized = $("form").serializeArray()
        formDict = {};
        formSerialized.forEach(function (field) {
          formDict[field.name] = field.value;
        });

        // post as info to dallimger
        my_node_id = localStorage.getItem("node_id")
        dallinger.createInfo(my_node_id, {info_type:'comprehensiontest', contents:JSON.stringify(formDict)})
        .done(function (resp) {
            spinner.unfreeze();
            updateFeedback(resp)
        })
        .fail(function (err) {
            spinner.unfreeze();  
            dallinger.allowExit();        
            dallinger.goToPage('questionnaire')
        })
      }
    
      updateFeedback = function (resp) {
        if (resp.info.property1 == "true") {
          $("#questions-div").hide()
          $("#instructions-div-success").attr("style", "visibility:visible")
          // console.log("passed")
        }

        else {
          // console.log("failed")
          // console.log(resp)
          $("#questions-div").hide()
          $("#instructions-div-failure").attr("style", "visibility:visible")
        }
      }

        $(document).ready(function () {$("#submit-pregame-questions").click(function() {submitQuestions()});})
  </script>
{% endblock %}