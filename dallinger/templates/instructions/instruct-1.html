{% extends "layout.html" %}

{% block body %}
    <div class="main_div">
        <h1>Welcome</h1>
        <hr>
        <p id='welcome_message'>Welcome to the experiment!</p>
        <hr>
        <div>
            <div class="row">
                <div class="col-xs-10"></div>
                <div class="col-xs-2">

                    <button type="button" class="btn btn-primary btn-lg" id ="instruct1_button" onClick="advance();">
                    Next</button>
                </div>
            </div>
        </div>
        <p id='loading_message' style='visibility:hidden;text-align:center;'>Loading the experiment ...</p>
    </div>
{% endblock %}

{% block scripts %}
    <script type="text/javascript">
        create_agent = function() {
          dallinger.createAgent()
            
            .done(function (resp) {

                localStorage.setItem("node_id",parseInt(resp.node.id));
                var generation = parseInt(resp.node.property2)
                localStorage.setItem("generation",generation);
                localStorage.setItem("condition",resp.node.property5);
                var prop_blue = parseFloat(resp.node.property4)
                localStorage.setItem("prop_blue",prop_blue);
                localStorage.setItem("trial_type",resp.node.property1);
                var network_id = parseInt(resp.node.network_id)
                localStorage.setItem("network_id",network_id);
                var nextpage = 'instructions/instruct-2'
                localStorage.setItem("decision_index",parseInt(resp.node.property3));

                var network_string = '/network/' + String(network_id)
                dallinger.get(network_string).done(function(netresp) {
                    var net_decision_index = parseInt(netresp.network.property4);
                    localStorage.setItem("net_decision_index",net_decision_index);
                    dallinger.goToPage(nextpage) 
                })
            })
            
            .fail(function () {
              dallinger.goToPage('questionnaire');
            });
        };

        advance = function (){
            $('#instruct1_button').addClass('disabled')
            $('#loading_message').css('visibility','visible')
            $(document).ready(function () {
                dallinger.createParticipant()
                .done(function () {
                    create_agent()
                });
            })
        }
        
    </script>
{% endblock %}

